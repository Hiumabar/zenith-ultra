<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zenith Ultra - Arsitektur Finansial Masa Depan</title>
    <meta name="description" content="Zenith Ultra: Aplikasi manajemen keuangan cerdas dengan sistem tracking streak, heatmap aktivitas, dan analisis portofolio premium.">
    
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://zenith-ultra-save.netlify.app/"> 
    <meta property="og:title" content="Zenith Ultra - Arsitektur Finansial Masa Depan">
    <meta property="og:description" content="Pantau progres menabung, streak harian, dan analisis portofolio premium dalam satu aplikasi cerdas.">
    <meta property="og:image" content="https://i.ibb.co.com/PLCqHHz/app-icon.png">

    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:title" content="Zenith Ultra - Arsitektur Finansial Masa Depan">
    <meta property="twitter:description" content="Kelola keuanganmu dengan arsitektur masa depan di Zenith Ultra!">
    <meta property="twitter:image" content="https://i.ibb.co.com/PLCqHHz/app-icon.png">

    <meta name="google-site-verification" content="HuH731if_mx1v-_UBpD2SQ61c2JBhEEctxXELLG40sc" />
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#10b981">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="icon" type="image/png" href="https://i.ibb.co.com/PLCqHHz/app-icon.png">
    <link rel="apple-touch-icon" href="https://i.ibb.co.com/PLCqHHz/app-icon.png">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>       
        :root { --bg: #030712; --card: #111827; --text: #f9fafb; --prim: #10b981; --border: #1f2937; --sec: #374151; --accent: #f59e0b; --danger: #ef4444; --shadow: rgba(0,0,0,0.4); }
        .light-mode { --bg: #f3f4f6; --card: #ffffff; --text: #111827; --border: #e5e7eb; --prim: #059669; --sec: #d1d5db; --accent: #d97706; --shadow: rgba(0,0,0,0.1); }
        
        * { box-sizing: border-box; font-family: 'Inter', -apple-system, sans-serif; transition: 0.25s cubic-bezier(0.4, 0, 0.2, 1); -webkit-user-select: none; user-select: none; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); margin: 0; padding: 16px; padding-bottom: 200px; overflow-x: hidden; scroll-behavior: smooth; }
        .reveal { opacity: 0; transform: translateY(30px); transition: all 0.6s ease-out; }
        .reveal.active { opacity: 1; transform: translateY(0); }
        .card { background: var(--card); border-radius: 24px; padding: 24px; margin-bottom: 16px; border: 1px solid var(--border); box-shadow: 0 10px 15px -3px var(--shadow); position: relative; }
        .flex { display: flex; justify-content: space-between; align-items: center; }
        .badge { font-size: 10px; padding: 4px 10px; border-radius: 50px; font-weight: bold; background: var(--prim); color: #000; }
        .streak-badge { background: rgba(245, 158, 11, 0.1); color: var(--accent); border: 1px solid var(--accent); }
        .heat-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; margin-top: 10px; }
        .cell { aspect-ratio: 1; background: var(--sec); border-radius: 5px; }
        .cell.active { background: var(--prim); box-shadow: 0 0 12px var(--prim); }
        .p-bg { background: var(--sec); height: 10px; border-radius: 10px; margin: 12px 0; overflow: hidden; }
        .p-fill { background: linear-gradient(90deg, var(--prim), #34d399); height: 100%; transition: 1.5s cubic-bezier(0.17, 0.67, 0.83, 0.67); }
        .btn { border: none; padding: 14px; border-radius: 18px; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 14px; position: relative; }
        .btn:active { transform: scale(0.92); }
        .btn-prim { background: var(--prim); color: #000; box-shadow: 0 8px 20px -6px var(--prim); }
        .btn-sec { background: var(--card); color: var(--text); border: 1px solid var(--border); }
        .btn-del { background: transparent; color: var(--danger); border: none; padding: 5px; cursor: pointer; font-size: 18px; }
        .fab-container { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); width: 92%; max-width: 420px; background: rgba(17, 24, 39, 0.7); backdrop-filter: blur(25px); padding: 10px; border-radius: 100px; display: flex; gap: 10px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); border: 1px solid rgba(255,255,255,0.08); z-index: 1000; }
        .fab-btn { border-radius: 100px !important; flex: 1; height: 54px; }
        .fab-main { flex: 2.2; background: var(--prim); color: #000; }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(15px); display: none; align-items: center; justify-content: center; z-index: 2000; padding: 20px; opacity: 0; }
        .modal.active { display: flex; opacity: 1; }
        .modal-content { background: var(--card); width: 100%; max-width: 500px; border-radius: 32px; padding: 28px; max-height: 90vh; overflow-y: auto; border: 1px solid var(--border); }
        input, select, textarea { width: 100%; padding: 16px; border-radius: 16px; background: var(--bg); color: var(--text); border: 1px solid var(--border); margin-bottom: 16px; outline: none; font-size: 16px; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 20px 0; }
        .stat-item { background: var(--bg); padding: 16px; border-radius: 20px; border: 1px solid var(--border); }
        .stat-label { font-size: 10px; opacity: 0.5; text-transform: uppercase; letter-spacing: 1px; }
        .stat-val { font-size: 16px; font-weight: 800; color: var(--prim); margin-top: 4px; }
        .history-table { width: 100%; border-collapse: separate; border-spacing: 0 8px; font-size: 12px; }
        .history-table tr { background: var(--bg); }
        .history-table td { padding: 12px; border-top: 1px solid var(--border); border-bottom: 1px solid var(--border); }
        .history-table td:first-child { border-left: 1px solid var(--border); border-radius: 12px 0 0 12px; }
        .history-table td:last-child { border-right: 1px solid var(--border); border-radius: 0 12px 12px 0; }
        
        .page-content { display: none; animation: fadeIn 0.5s ease; padding-bottom: 60px; }
        .page-content.active { display: block; }
        .nav-footer { text-align: center; margin-top: 40px; padding: 20px; border-top: 1px solid var(--border); opacity: 0.8; }
        .nav-links { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; margin-bottom: 15px; }
        .nav-item { font-size: 12px; color: var(--prim); text-decoration: none; cursor: pointer; font-weight: 600; }
        .copyright { font-size: 11px; opacity: 0.5; margin-top: 10px; }
        .share-card { background: linear-gradient(135deg, #064e3b 0%, #030712 100%); padding: 30px; border-radius: 30px; border: 2px solid var(--prim); color: white; text-align: left; position: relative; overflow: hidden; }
        .share-card::after { content: 'ZENITH'; position: absolute; right: -20px; bottom: -10px; font-size: 80px; font-weight: 900; opacity: 0.05; font-style: italic; }
        .share-preview-container { margin: 20px 0; perspective: 1000px; }
        .preview-box { transform: rotateX(5deg); box-shadow: 0 20px 40px rgba(0,0,0,0.5); }
        
        #wizard { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 30px; text-align: center; }
        .wiz-step { width: 100%; max-width: 400px; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        
        .day-selector { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin: 20px 0; }
        .day-opt { padding: 10px 5px; border-radius: 12px; background: var(--sec); font-size: 11px; font-weight: bold; cursor: pointer; border: 2px solid transparent; text-align: center; }
        .day-opt.active { background: rgba(16, 185, 129, 0.2); border-color: var(--prim); color: var(--prim); }
        .modal-section-title { font-size: 11px; opacity: 0.5; letter-spacing: 1.5px; margin: 20px 0 10px 0; text-transform: uppercase; font-weight: 800; border-bottom: 1px solid var(--border); padding-bottom: 5px; }

        .social-box { display: flex; justify-content: center; gap: 25px; margin: 20px 0; font-size: 24px; }
        .social-box a { color: var(--text); opacity: 0.6; transition: 0.3s; }
        .social-box a:hover { opacity: 1; transform: translateY(-3px); }
        .social-box a:hover .fa-instagram { color: #e4405f; }
        .social-box a:hover .fa-x-twitter { color: #1da1f2; }
        .social-box a:hover .fa-github { color: #6e5494; }
        .social-box a:hover .fa-envelope { color: var(--prim); }

        /* Custom Popup & Toast Styles */
        #custom-toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: var(--card);
            border: 1px solid var(--prim);
            padding: 12px 24px;
            border-radius: 100px;
            z-index: 10000;
            transition: 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 14px;
        }
        #custom-toast.show { transform: translateX(-50%) translateY(0); }

        .confirm-box { text-align: center; padding: 10px; }
        .confirm-btns { display: flex; gap: 10px; margin-top: 25px; }
    </style>
</head>
<body oncontextmenu="return false">

<div id="custom-toast"></div>
<div id="confirmModal" class="modal">
    <div class="modal-content confirm-box">
        <div id="confirmIcon" style="font-size: 50px; margin-bottom: 15px;">‚ö†Ô∏è</div>
        <h3 id="confirmTitle">Konfirmasi</h3>
        <p id="confirmMsg" style="opacity: 0.7; font-size: 14px;"></p>
        <div class="confirm-btns">
            <button class="btn btn-sec" style="flex:1" onclick="closeConfirm(false)">Batal</button>
            <button class="btn btn-prim" style="flex:1" id="confirmOkBtn">Ya, Lanjutkan</button>
        </div>
    </div>
</div>

<div id="wizard">
    <div class="wiz-step" id="step1">
        <h1 style="color:var(--prim); font-size: 48px; margin-bottom:10px; letter-spacing: -2px;">Zenith.</h1>
        <p style="opacity:0.7; font-size: 18px;">Arsitektur finansial masa depan Anda.</p>
        <button class="btn btn-prim" onclick="nextStep(2)" style="margin: 30px auto; width: 220px; border-radius: 100px;">Mulai Eksplorasi</button>
    </div>
    <div class="wiz-step" id="step2" style="display:none">
        <span style="font-size: 40px;">üéØ</span>
        <h2>Target Utama</h2>
        <p style="font-size:14px; opacity:0.6;">Apa impian besar pertama yang ingin dicapai?</p>
        <input type="text" id="oName" placeholder="Contoh: Dana Darurat">
        <input type="number" id="input_oGoal" placeholder="Target Nominal (Rp)">
        <button class="btn btn-prim" onclick="nextStep(3)" style="margin: 10px auto; width: 100%; border-radius: 100px;">Lanjut</button>
    </div>
    <div class="wiz-step" id="step3" style="display:none">
        <span style="font-size: 40px;">üìÖ</span>
        <h2>Jadwal Menabung</h2>
        <p style="font-size: 14px; opacity: 0.6;">Pilih hari spesifik untuk target ini.</p>
        <div class="day-selector" id="wizDayPicker">
            <div class="day-opt active" onclick="this.classList.toggle('active')" data-day="1">Senin</div>
            <div class="day-opt active" onclick="this.classList.toggle('active')" data-day="2">Selasa</div>
            <div class="day-opt active" onclick="this.classList.toggle('active')" data-day="3">Rabu</div>
            <div class="day-opt active" onclick="this.classList.toggle('active')" data-day="4">Kamis</div>
            <div class="day-opt active" onclick="this.classList.toggle('active')" data-day="5">Jumat</div>
            <div class="day-opt" onclick="this.classList.toggle('active')" data-day="6">Sabtu</div>
            <div class="day-opt" onclick="this.classList.toggle('active')" data-day="0">Minggu</div>
        </div>
        <button class="btn btn-prim" onclick="nextStep(4)" style="margin: 10px auto; width: 100%; border-radius: 100px;">Tinjau Sistem</button>
    </div>
    <div class="wiz-step" id="step4" style="display:none">
        <div style="font-size: 60px; margin-bottom: 10px;">‚ú®</div>
        <h2>Sistem Siap</h2>
        <p style="font-size: 14px; opacity: 0.6; margin-bottom: 30px;">Zenith telah dikonfigurasi. Streak akan dihitung berdasarkan hari yang Anda pilih.</p>
        <button class="btn btn-prim" onclick="initApp()" style="margin: 0 auto; width: 100%; border-radius: 100px;">Aktifkan Zenith</button>
    </div>
</div>

<div id="main-app-ui">
    <div class="flex reveal" style="margin-bottom:20px; padding-top: 10px;">
        <h2 onclick="showPage('home')" style="margin:0; letter-spacing:-1.5px; font-weight: 900; font-size: 24px; cursor:pointer;">ZENITH ULTRA<span style="color:var(--prim)">.</span></h2>
        <div class="flex" style="gap:10px;">
            <div class="badge streak-badge">üî• <span id="stkVal">0</span> DAYS</div>
            <button onclick="toggleTheme()" class="btn btn-sec" style="padding:0; border-radius:50%; width:44px; height:44px; border: none; background: var(--card);">üåì</button>
        </div>
    </div>

    <div id="page-home" class="page-container">
        <div class="card reveal" onclick="openStats()" style="cursor: pointer;">
            <div class="flex">
                <span style="font-size:10px; font-weight:800; opacity:0.6; letter-spacing: 1.5px;">MARKET ANALYTICS</span>
                <span id="levelBadge" class="badge">Bronze Tier</span>
            </div>
            <div class="heat-grid" id="heatGrid"></div>
            <canvas id="mainChart" height="140" style="margin-top:20px;"></canvas>
        </div>
        
        <div id="targetList"></div>
        <div id="targetPagination" class="flex" style="justify-content: center; gap: 15px; margin-top: 10px; margin-bottom: 20px;"></div>
    </div>

    <div id="page-about" class="page-content">
        <div class="card">
            <h3 style="color:var(--prim)">Tentang Zenith Ultra</h3>
            <p style="line-height:1.6; opacity:0.9;">Zenith Ultra adalah platform manajemen keuangan personal yang mengusung konsep <b>Arsitektur Finansial</b>. Website ini dirancang untuk mereka yang ingin disiplin dalam menabung melalui sistem gamifikasi.</p>
            <div class="modal-section-title">Fitur Unggulan</div>
            <ul style="padding-left: 20px; line-height: 1.8;">
                <li><b>Daily Streak:</b> Menjaga momentum menabung Anda tetap membara.</li>
                <li><b>Activity Heatmap:</b> Visualisasi kontribusi tabungan secara periodik.</li>
                <li><b>Premium Export:</b> Simpan data Anda dalam format PDF atau Excel.</li>
                <li><b>Smart Estimation:</b> Prediksi kapan target Anda akan tercapai berdasarkan tren.</li>
            </ul>
        </div>
    </div>

    <div id="page-contact" class="page-content">
        <div class="card">
            <h3 style="color:var(--prim)">Hubungi Kami</h3>
            <p style="font-size:13px; opacity:0.7; margin-bottom:20px;">Punya pertanyaan atau saran? Kirimkan pesan langsung kepada tim pengembang kami.</p>
            <div id="contact-success" style="display:none; background: rgba(16, 185, 129, 0.1); border: 1px solid var(--prim); color: var(--prim); padding: 15px; border-radius: 16px; margin-bottom: 20px; text-align: center;">
                <i class="fas fa-check-circle"></i> Pesan berhasil dikirim!
            </div>
            <form id="zenith-contact-form">
                <input type="text" name="name" placeholder="Nama Lengkap" required>
                <input type="email" name="email" placeholder="Email Anda" required>
                <textarea name="message" rows="4" placeholder="Tulis pesan Anda di sini..." required style="resize: none;"></textarea>
                <button type="submit" id="btn-submit-contact" class="btn btn-prim" style="width:100%">Kirim Pesan Sekarang</button>
            </form>
            <div class="modal-section-title" style="text-align: center; margin-top:20px;">Social Media</div>
            <div class="social-box">
                <a href="https://instagram.com/nextterrastudio" target="_blank"><i class="fab fa-instagram"></i></a>
                <a href="https://twitter.com/nextterrastudio" target="_blank"><i class="fab fa-x-twitter"></i></a>
                <a href="https://github.com/Hiumabar" target="_blank"><i class="fab fa-github"></i></a>
                <a href="mailto:nextterrastudio@gmail.com"><i class="fas fa-envelope"></i></a>
            </div>
        </div>
    </div>

    <div id="page-privacy" class="page-content">
        <div class="card">
            <h3>Kebijakan Privasi</h3>
            <p style="font-size:14px; line-height:1.6; opacity:0.8;">
                Keamanan data Anda adalah prioritas kami. Zenith Ultra beroperasi dengan prinsip <b>Offline-First</b>. Semua data transaksi, target, dan histori Anda disimpan di penyimpanan lokal (LocalStorage) perangkat Anda sendiri. <br><br>
                Kami tidak mengunggah data finansial Anda ke server manapun. Anda memiliki kendali penuh untuk mengekspor atau menghapus data Anda kapan saja.
            </p>
        </div>
    </div>

    <div id="page-tos" class="page-content">
        <div class="card">
            <h3>Syarat & Ketentuan</h3>
            <p style="font-size:14px; line-height:1.6; opacity:0.8;">
                Dengan menggunakan Zenith Ultra, Anda memahami bahwa aplikasi ini adalah alat bantu pencatatan finansial pribadi. <br><br>
                1. Pengguna bertanggung jawab penuh atas data yang dimasukkan.<br>
                2. Kami tidak bertanggung jawab atas kehilangan data akibat penghapusan cache browser atau kerusakan perangkat.<br>
                3. Zenith Ultra bukan lembaga keuangan dan tidak mengelola dana nyata Anda.
            </p>
        </div>
    </div>

    <footer class="nav-footer reveal">
        <div class="nav-links">
            <span class="nav-item" onclick="showPage('home')">Beranda</span>
            <span class="nav-item" onclick="showPage('about')">Tentang</span>
            <span class="nav-item" onclick="showPage('contact')">Kontak</span>
            <span class="nav-item" onclick="showPage('privacy')">Privasi</span>
            <span class="nav-item" onclick="showPage('tos')">Syarat & Ketentuan</span>
        </div>
        <div class="copyright">Next Terra Studio 2026 &copy; All Rights Reserved.</div>
    </footer>
</div>

<div class="fab-container">
    <button class="btn btn-sec fab-btn" onclick="openModal('exportModal')">üíæ</button>
    <button class="btn fab-btn fab-main" onclick="openModal('saveModal')"><b>üí∞ TRANSAKSI</b></button>
    <button class="btn btn-sec fab-btn" onclick="openModal('targetModal')">üéØ</button>
</div>

<div id="exportModal" class="modal">
    <div class="modal-content">
        <h3 style="margin-top:0">Manajemen Data</h3>
        <div class="modal-section-title">Data Portofolio</div>
        <button class="btn btn-prim" onclick="handleExport('pdf')" style="margin-bottom:12px; background:#ef4444; color:white; width: 100%;">üìï Ekspor PDF Premium</button>
        <button class="btn btn-prim" onclick="handleExport('excel')" style="margin-bottom:12px; background:#10b981; color:black; width: 100%;">üìó Ekspor Excel</button>
                <div class="modal-section-title">Backup & Restore (JSON)</div>
        <button class="btn btn-sec" onclick="downloadJSON()" style="width:100%; margin-bottom:10px;">üìÑ Simpan File JSON</button>
        <button class="btn btn-sec" onclick="document.getElementById('importFile').click()" style="width:100%; border: 1px dashed var(--prim); margin-bottom:10px;">üì• Pulihkan dari JSON</button>
        <input type="file" id="importFile" style="display:none" accept=".json" onchange="handleFileImport(event)">

        <div class="modal-section-title">Backup & Restore (Kode)</div>
        <button class="btn btn-sec" onclick="backupData()" style="width:100%; margin-bottom:10px;">üì§ Salin Backup Kode</button>
        <button class="btn btn-sec" onclick="restoreFromCode()" style="width:100%; border: 1px dashed var(--prim);">üì• Pulihkan dari Kode</button>

        <div class="modal-section-title">Share</div>
        <button class="btn btn-prim" onclick="openShare()" style="margin-bottom:12px; background:linear-gradient(45deg, #10b981, #3b82f6); color:white; width: 100%;">üîó Bagikan Pencapaian (Card)</button>
        <button class="btn btn-sec" onclick="shareWebsite()" style="margin-bottom:12px; border: 1px solid var(--prim); width: 100%;">üåê Bagikan Link Website</button>
        <button class="btn btn-sec" onclick="closeModal('exportModal')" style="width:100%; margin-top:20px; border-radius: 100px;">Tutup</button>
    </div>
</div>

<div id="shareModal" class="modal">
    <div class="modal-content" style="max-width: 450px;">
        <h3 style="margin-top:0">Zenith Share Card</h3>
        <div id="shareArea" class="share-preview-container">
            <div class="share-card preview-box" id="captureTarget">
                <div style="font-size: 10px; letter-spacing: 2px; opacity: 0.8; margin-bottom: 5px;">ZENITH FINANCIAL ARCHITECT</div>
                <h2 style="margin: 0; color: var(--prim); font-size: 28px;" id="sT_title">My Portfolio</h2>
                <div style="margin: 25px 0;">
                    <div style="font-size: 12px; opacity: 0.7;">TOTAL ASSET VALUE</div>
                    <div style="font-size: 24px; font-weight: 900;" id="sT_assets">Rp 0</div>
                </div>
                <div class="flex">
                    <div>
                        <div style="font-size: 10px; opacity: 0.7;">STREAK</div>
                        <div style="font-size: 18px; font-weight: 700; color: #f59e0b;" id="sT_streak">0 Days</div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 10px; opacity: 0.7;">STATUS</div>
                        <div id="sT_tier" style="font-weight: 700;">PRO MEMBER</div>
                    </div>
                </div>
                <div style="margin-top: 20px; font-size: 10px; opacity: 0.5; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px;">Dibuat di Zenith Ultra - Digital Financial Tracker</div>
            </div>
        </div>
        <button class="btn btn-prim" onclick="downloadShareCard()" style="width:100%;">üì∏ Simpan & Bagikan Gambar</button>
        <button class="btn btn-sec" onclick="closeModal('shareModal')" style="width:100%; margin-top:12px; border-radius: 100px;">Kembali</button>
    </div>
</div>

<div id="saveModal" class="modal">
    <div class="modal-content">
        <h3 style="margin-top:0">Input Transaksi</h3>
        <select id="saveType">
            <option value="in">üí∞ Masuk (Nabung)</option>
            <option value="out">üí∏ Keluar (Tarik)</option>
        </select>
        <select id="saveTo"></select>
        <input type="number" id="saveAmt" placeholder="Jumlah Rp" inputmode="numeric">
        <button class="btn btn-prim" onclick="handleSaveAction()" style="width: 100%;">Proses Transaksi</button>
        <button class="btn btn-sec" onclick="closeModal('saveModal')" style="width:100%; margin-top:12px; border-radius: 100px;">Batal</button>
    </div>
</div>

<div id="targetModal" class="modal">
    <div class="modal-content">
        <h3 style="margin-top:0">üéØ Target Baru</h3>
        <input type="text" id="ntName" placeholder="Nama Barang">
        <input type="number" id="ntGoal" placeholder="Target Dana">
        <p style="font-size: 12px; opacity: 0.6; margin-bottom: 8px;">Pilih Hari Menabung:</p>
        <div class="day-selector" id="targetDayPicker">
            <div class="day-opt active" onclick="this.classList.toggle('active')" data-day="1">Senin</div>
            <div class="day-opt active" onclick="this.classList.toggle('active')" data-day="2">Selasa</div>
            <div class="day-opt active" onclick="this.classList.toggle('active')" data-day="3">Rabu</div>
            <div class="day-opt active" onclick="this.classList.toggle('active')" data-day="4">Kamis</div>
            <div class="day-opt active" onclick="this.classList.toggle('active')" data-day="5">Jumat</div>
            <div class="day-opt" onclick="this.classList.toggle('active')" data-day="6">Sabtu</div>
            <div class="day-opt" onclick="this.classList.toggle('active')" data-day="0">Minggu</div>
        </div>
        <button class="btn btn-prim" onclick="doAddTarget()" style="width: 100%;">Simpan Target</button>
        <button class="btn btn-sec" onclick="closeModal('targetModal')" style="width:100%; margin-top:12px; border-radius: 100px;">Batal</button>
    </div>
</div>

<div id="statsModal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
        <div class="flex">
            <h3 style="color:var(--prim); margin:0">Zenith Insights</h3>
            <button class="btn-del" onclick="closeModal('statsModal')" style="font-size: 24px;">√ó</button>
        </div>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-label">Total Assets</div>
                <div class="stat-val" id="statTotal">Rp 0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Saving Streak</div>
                <div class="stat-val" id="statStreak">0 Days</div>
            </div>
        </div>
        <canvas id="barChart" height="200"></canvas>
        <h4 style="margin: 25px 0 15px 0; font-size: 14px; opacity: 0.7;">ACTIVITY LOG</h4>
        <div style="overflow-x: auto;">
            <table class="history-table">
                <tbody id="historyBody"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
/* --- DATABASE INITIALIZATION --- */
let db = JSON.parse(localStorage.getItem('ss_ultra_db')) || { 
    targets: [], 
    logs: [], 
    streak: 0, 
    lastDate: null, 
    theme: 'dark'
};

// Global state untuk pagination
let currentPage = 1;
const itemsPerPage = 3;

/* --- SYSTEM POPUP & TOAST --- */
function showToast(msg, icon = '‚úÖ') {
    const toast = document.getElementById('custom-toast');
    toast.innerHTML = `<span>${icon}</span> ${msg}`;
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 3000);
}

let confirmCallback = null;
function showConfirm(title, msg, icon, callback) {
    document.getElementById('confirmTitle').innerText = title;
    document.getElementById('confirmMsg').innerText = msg;
    document.getElementById('confirmIcon').innerText = icon;
    confirmCallback = callback;
    openModal('confirmModal');
    document.getElementById('confirmOkBtn').onclick = () => {
        closeConfirm(true);
    };
}

function closeConfirm(result) {
    closeModal('confirmModal');
    if(result && confirmCallback) confirmCallback();
    confirmCallback = null;
}

/* --- APP WIZARD LOGIC --- */
function nextStep(s) { 
    const n = document.getElementById('oName').value;
    const g = parseInt(document.getElementById('input_oGoal').value); // Parse ke integer
    
    // Tambahkan validasi g <= 0
    if(s === 3 && (!n || !g || g <= 0)) return showToast("Isi nama target dan nominal lebih dari Rp0!", "‚ùå");
    
    document.querySelectorAll('.wiz-step').forEach(el => el.style.display = 'none'); 
    document.getElementById('step'+s).style.display = 'block'; 
}

function initApp() { 
    const n = document.getElementById('oName').value;
    const g = parseInt(document.getElementById('input_oGoal').value); // Parse ke integer
    const activeDays = Array.from(document.querySelectorAll('#wizDayPicker .day-opt.active')).map(el => parseInt(el.dataset.day));
    
    // Ubah kondisi menjadi g > 0
    if(n && g > 0 && activeDays.length > 0) { 
        db.targets.push({name:n, goal:g, saved:0, schedule: activeDays, id: Date.now()}); 
        save(); 
        document.getElementById('wizard').style.display = 'none';
        showToast("Sistem Zenith Diaktifkan!", "üöÄ");
    } else { 
        showToast("Pastikan target > Rp0 dan pilih minimal 1 hari!", "‚ùó"); 
    }
}


/* --- NAVIGATION & THEME --- */
function showPage(pageId) {
    document.querySelectorAll('.page-content').forEach(p => p.classList.remove('active'));
    document.getElementById('page-home').style.display = (pageId === 'home') ? 'block' : 'none';
    if(pageId !== 'home') document.getElementById('page-' + pageId).classList.add('active');
    window.scrollTo(0,0);
    reveal();
}

function toggleTheme() { 
    document.body.classList.toggle('light-mode'); 
    db.theme = document.body.classList.contains('light-mode') ? 'light' : 'dark';
    localStorage.setItem('ss_ultra_db', JSON.stringify(db));
}

/* --- CORE TRANSACTIONS --- */
function handleSaveAction() {
    const idx = document.getElementById('saveTo').value;
    let amt = parseInt(document.getElementById('saveAmt').value);
    if(!amt || amt <= 0) return showToast("Masukkan nominal valid", "‚ùó");
    
    const type = document.getElementById('saveType').value;
    if(type === 'out') {
        if(db.targets[idx].saved < amt) { showToast("Saldo Tidak Cukup", "‚ùå"); return; }
        amt = -amt;
    }
    
    db.targets[idx].saved += amt;
    const now = new Date();
    const todayStr = now.toDateString();
    
    if(amt > 0) {
        const targetSchedule = db.targets[idx].schedule || [1,2,3,4,5];
        if (db.lastDate !== todayStr && targetSchedule.includes(now.getDay())) {
            db.streak++;
            db.lastDate = todayStr;
        }
    }
    
    db.logs.push({ d: new Date().toISOString(), v: amt, t: db.targets[idx].name });
    closeModal('saveModal');
    document.getElementById('saveAmt').value = '';
    save();
    showToast(amt > 0 ? "Tabungan Berhasil!" : "Penarikan Berhasil!", amt > 0 ? "üí∞" : "üí∏");
}

 function doAddTarget() {
    const n = document.getElementById('ntName').value;
    const g = parseInt(document.getElementById('ntGoal').value); // Ubah ke integer dulu
    const activeDays = Array.from(document.querySelectorAll('#targetDayPicker .day-opt.active')).map(el => parseInt(el.dataset.day));
    
    // Tambahkan validasi g > 0
    if(n && g > 0 && activeDays.length > 0) {
        db.targets.push({name:n, goal:g, saved:0, schedule: activeDays, id: Date.now()});
        save(); 
        closeModal('targetModal');
        document.getElementById('ntName').value = ''; 
        document.getElementById('ntGoal').value = '';
        showToast("Target Baru Ditambahkan", "üéØ");
    } else { 
        showToast("Lengkapi data dan pastikan nominal lebih dari 0!", "‚ùó"); 
    }
}


function deleteTarget(realIndex) { 
    showConfirm("Hapus Target?", "Data tabungan pada target ini akan hilang permanen.", "üóëÔ∏è", () => {
        db.targets.splice(realIndex, 1);
        const maxPage = Math.ceil(db.targets.length / itemsPerPage) || 1;
        if (currentPage > maxPage) currentPage = maxPage;
        save();
        showToast("Target dihapus", "üöÆ");
    });
}

/* --- DATA PERSISTENCE & RENDER --- */
function save() { 
    localStorage.setItem('ss_ultra_db', JSON.stringify(db)); 
    render(); 
}

function render() {
    document.getElementById('wizard').style.display = db.targets.length === 0 ? 'flex' : 'none';
    document.getElementById('stkVal').innerText = db.streak;
    
    const list = document.getElementById('targetList');
    const pagin = document.getElementById('targetPagination');
    
    const startIndex = (currentPage - 1) * itemsPerPage;
    const endIndex = startIndex + itemsPerPage;
    const paginatedTargets = db.targets.slice(startIndex, endIndex);
    const totalPages = Math.ceil(db.targets.length / itemsPerPage);

    list.innerHTML = paginatedTargets.map((t, i) => {
        const realIndex = startIndex + i;
        const p = Math.min((t.saved/t.goal)*100, 100).toFixed(1);
        const dayLabels = ["Min","Sen","Sel","Rab","Kam","Jum","Sab"];
        const schedHint = t.schedule ? t.schedule.map(d => dayLabels[d]).join(", ") : "Hari Kerja";
        
        return `
            <div class="card reveal active">
                <div class="flex">
                    <b style="font-size:18px">${t.name}</b>
                    <div class="flex" style="gap:12px;">
                        <span class="badge">${p}%</span>
                        <button class="btn-del" onclick="deleteTarget(${realIndex})">üóëÔ∏è</button>
                    </div>
                </div>
                <div class="p-bg"><div class="p-fill" style="width:${p}%"></div></div>
                <div class="flex" style="font-size:12px; font-weight:700">
                    <span>Rp ${t.saved.toLocaleString()}</span>
                    <span style="opacity:0.5">Target Rp ${t.goal.toLocaleString()}</span>
                </div>
                <div class="flex" style="font-size:10px; margin-top:12px; font-weight:800;">
                    <span style="color:var(--accent)">‚ö° ${getEstimation(t)}</span>
                    <span style="opacity:0.4">üìÖ ${schedHint}</span>
                </div>
            </div>`;
    }).join('');

    if (totalPages > 1) {
        let paginHTML = '';
        for (let i = 1; i <= totalPages; i++) {
            const activeStyle = i === currentPage ? 'background:var(--prim); color:#000;' : 'background:var(--card); opacity:0.6;';
            paginHTML += `<div onclick="changePage(${i})" style="width:35px; height:35px; border-radius:10px; display:flex; align-items:center; justify-content:center; cursor:pointer; font-weight:bold; font-size:12px; border:1px solid var(--border); ${activeStyle}">${i}</div>`;
        }
        pagin.innerHTML = paginHTML;
    } else {
        pagin.innerHTML = '';
    }

    renderHeatmap(); 
    renderLineChart();
    
    const total = db.targets.reduce((a,b)=>a+b.saved, 0);
    const tierBadge = document.getElementById('levelBadge');
    if (tierBadge) {
        if(total > 5000000) tierBadge.innerText = "Platinum Tier";
        else if(total > 1000000) tierBadge.innerText = "Gold Tier";
        else if(total > 500000) tierBadge.innerText = "Silver Tier";
        else tierBadge.innerText = "Bronze Tier";
    }

    setTimeout(reveal, 100);
}

function changePage(p) {
    currentPage = p;
    render();
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

/* --- ANALYTICS & STATS --- */
function getEstimation(target) {
    const remaining = target.goal - target.saved;
    if (remaining <= 0) return "Target Tercapai! üèÜ";
    const logs = db.logs.filter(l => l.t === target.name && l.v > 0);
    if (logs.length < 2) return "Menunggu data...";
    const start = new Date(logs[0].d);
    const end = new Date(logs[logs.length-1].d);
    const days = Math.max(1, Math.round((end - start) / 86400000));
    const total = logs.reduce((s, l) => s + l.v, 0);
    const avg = total / days;
    const daysLeft = Math.ceil(remaining / avg);
    return daysLeft > 30 ? `${(daysLeft/30).toFixed(1)} Bulan lagi` : `${daysLeft} Hari lagi`;
}

function renderHeatmap() {
    const h = document.getElementById('heatGrid'); 
    h.innerHTML = '';
    
    for(let i=0; i<21; i++) {
        const d = new Date(); 
        d.setDate(d.getDate() - (20-i));
        const dateStr = d.toDateString(); // Untuk pencocokan data
        
        // Format tanggal agar enak dibaca, contoh: "12 Okt"
        const displayDate = d.toLocaleDateString('id-ID', {day: 'numeric', month: 'short'}); 
        
        // Cari semua transaksi di tanggal ini
        const dayLogs = db.logs.filter(l => new Date(l.d).toDateString() === dateStr);
        
        // Hitung total transaksi hari itu
        let dayTotal = 0;
        dayLogs.forEach(l => { dayTotal += l.v; });
        
        const c = document.createElement('div');
        c.className = 'cell' + (dayLogs.length > 0 ? ' active' : '');
        
        // Tambahkan efek saat kotak di-klik
        c.onclick = () => {
            if (dayLogs.length > 0) {
                const icon = dayTotal >= 0 ? 'üìà' : 'üìâ';
                const status = dayTotal >= 0 ? 'Nabung' : 'Tarik';
                showToast(`${displayDate} | ${status} Rp ${Math.abs(dayTotal).toLocaleString()}`, icon);
            } else {
                showToast(`${displayDate} | Belum ada aktivitas`, 'üí§');
            }
        };
        
        // Agar terlihat bisa di-klik
        c.style.cursor = 'pointer'; 
        
        h.appendChild(c);
    }
}


let lineChart, barChart;
function renderLineChart() {
    const ctx = document.getElementById('mainChart').getContext('2d');
    const lastData = db.logs.slice(-10).map(l => l.v);
    if(lineChart) lineChart.destroy();
    lineChart = new Chart(ctx, { type: 'line', data: { labels: lastData.map(()=>""), datasets: [{ data: lastData, borderColor: '#10b981', tension: 0.4, fill: true, backgroundColor: 'rgba(16,185,129,0.1)', pointRadius: 0 }] }, options: { animation: false, plugins: { legend: { display: false } }, scales: { y: { display: false }, x: { display: false } } } });
}

function openStats() {
    const total = db.targets.reduce((a,b)=>a+b.saved, 0);
    document.getElementById('statTotal').innerText = `Rp ${total.toLocaleString()}`;
    document.getElementById('statStreak').innerText = `${db.streak} Days`;
    const hBody = document.getElementById('historyBody');
    hBody.innerHTML = db.logs.slice().reverse().slice(0, 15).map(l => `<tr><td style="opacity:0.5">${new Date(l.d).toLocaleDateString('id-ID',{day:'2-digit', month:'short'})}</td><td><b>${l.t}</b></td><td style="text-align:right; color:${l.v > 0 ? 'var(--prim)' : 'var(--danger)'}">${l.v > 0 ? '+' : ''}${l.v.toLocaleString()}</td></tr>`).join('');
    openModal('statsModal');
    setTimeout(renderBarChart, 400);
}

function renderBarChart() {
    const ctx = document.getElementById('barChart').getContext('2d');
    const dataMap = {};
    db.logs.slice(-10).forEach(l => {
        const d = new Date(l.d).toLocaleDateString('id-ID', {day:'2-digit'});
        dataMap[d] = (dataMap[d] || 0) + Math.abs(l.v);
    });
    if(barChart) barChart.destroy();
    barChart = new Chart(ctx, { type: 'bar', data: { labels: Object.keys(dataMap), datasets: [{ data: Object.values(dataMap), backgroundColor: '#10b981', borderRadius: 8 }] }, options: { plugins: { legend: { display: false } }, scales: { y: { display: false }, x: { grid: { display: false } } } } });
}

/* --- EXPORT & SHARE --- */
function shareWebsite() {
    if (navigator.share) {
        navigator.share({
            title: 'Zenith Ultra',
            text: 'Kelola keuanganmu dengan arsitektur masa depan di Zenith Ultra!',
            url: window.location.href
        }).catch(console.error);
    } else {
        navigator.clipboard.writeText(window.location.href);
        showToast("Link disalin ke clipboard!");
    }
}

function openShare() {
    closeModal('exportModal');
    const total = db.targets.reduce((a,b)=>a+b.saved, 0);
    const primaryTarget = db.targets[0] ? db.targets[0].name : "Zenith User";
    
    document.getElementById('sT_assets').innerText = `Rp ${total.toLocaleString()}`;
    document.getElementById('sT_streak').innerText = `${db.streak} DAYS`;
    document.getElementById('sT_title').innerText = primaryTarget.toUpperCase();
    document.getElementById('sT_tier').innerText = total > 1000000 ? "PLATINUM" : "GOLD MEMBER";
    
    openModal('shareModal');
}

async function downloadShareCard() {
    const area = document.getElementById('captureTarget');
    area.style.transform = "none";
    const canvas = await html2canvas(area, { backgroundColor: '#030712', borderRadius: 30 });
    const imgData = canvas.toDataURL('image/png');
    const link = document.createElement('a');
    link.download = 'Zenith-Portfolio.png';
    link.href = imgData;
    link.click();
    area.style.transform = "rotateX(5deg)";
    showToast("Gambar Berhasil Disimpan", "üì∏");
}

function handleExport(type) {
    if(type === 'pdf') {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.text("Laporan Zenith Ultra", 10, 10);
        const data = db.targets.map(t => [t.name, `Rp ${t.saved.toLocaleString()}`, `Rp ${t.goal.toLocaleString()}`]);
        doc.autoTable({ head: [['Target', 'Tersimpan', 'Goal']], body: data });
        doc.save('Zenith-Report.pdf');
        showToast("PDF Berhasil Dibuat");
    } else {
        let csv = "Nama,Tersimpan,Target\n";
        db.targets.forEach(t => { csv += `"${t.name}",${t.saved},${t.goal}\n` });
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = 'Zenith-Data.csv'; a.click();
        showToast("Excel Berhasil Dibuat");
    }
}

/* --- PERFECTED BACKUP & RESTORE --- */
function backupData() { 
    try {
        const base64Data = btoa(unescape(encodeURIComponent(JSON.stringify(db))));
        navigator.clipboard.writeText(base64Data).then(() => {
            showToast("Kode backup (Base64) disalin!", "üìã");
        });
    } catch (e) { showToast("Gagal menyalin kode", "‚ùå"); }
}

function downloadJSON() {
    const dataStr = JSON.stringify(db, null, 2);
    const blob = new Blob([dataStr], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const dlAnchor = document.createElement('a');
    dlAnchor.href = url;
    dlAnchor.download = `ZENITH_BACKUP_${new Date().getTime()}.json`;
    document.body.appendChild(dlAnchor);
    dlAnchor.click();
    document.body.removeChild(dlAnchor);
    showToast("File JSON berhasil diunduh", "üìÑ");
}

function restoreFromCode() {
    const code = prompt("Tempel kode backup (Base64) Anda di sini:");
    if (code) {
        try {
            const decoded = decodeURIComponent(escape(atob(code)));
            processRestore(decoded);
        } catch(e) { 
            showToast("Kode tidak valid atau rusak!", "‚ùå"); 
        }
    }
}

function handleFileImport(event) {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (e) => processRestore(e.target.result);
    reader.readAsText(file);
    event.target.value = '';
}

function processRestore(jsonString) {
    try {
        const data = JSON.parse(jsonString);
        if (data && Array.isArray(data.targets) && Array.isArray(data.logs)) {
            showConfirm("Konfirmasi Restore", "Data saat ini akan dihapus dan diganti dengan data cadangan. Lanjutkan?", "‚ö†Ô∏è", () => {
                db = data;
                save();
                showToast("Sistem Berhasil Dipulihkan!", "‚úÖ");
                setTimeout(() => location.reload(), 1000);
            });
        } else {
            throw new Error("Struktur data tidak valid");
        }
    } catch (e) {
        showToast("Gagal memproses data! Pastikan format benar.", "‚ùå");
    }
}


/* --- UI HELPERS --- */
function openModal(id) {
    const m = document.getElementById(id);
    if(id === 'saveModal' && db.targets.length === 0) return showToast("Buat target dulu!", "üéØ");
    m.style.display = 'flex';
    setTimeout(() => m.classList.add('active'), 10);
    if(id === 'saveModal') document.getElementById('saveTo').innerHTML = db.targets.map((t,i) => `<option value="${i}">${t.name}</option>`).join('');
}

function closeModal(id) {
    const m = document.getElementById(id);
    if(!m) return;
    m.classList.remove('active');
    setTimeout(() => m.style.display = 'none', 300);
}

function reveal() {
    document.querySelectorAll(".reveal").forEach(el => {
        if (el.getBoundingClientRect().top < window.innerHeight - 50) el.classList.add("active");
    });
}

function validateStreak() {
    if (!db.lastDate || db.streak === 0) return;
    const last = new Date(db.lastDate);
    const now = new Date();
    now.setHours(0,0,0,0); last.setHours(0,0,0,0);
    if(last.getTime() === now.getTime()) return;
    let allScheduledDays = new Set();
    db.targets.forEach(t => { if(t.schedule) t.schedule.forEach(d => allScheduledDays.add(d)); });
    let checkDate = new Date(last);
    checkDate.setDate(checkDate.getDate() + 1);
    while(checkDate < now) {
        if(allScheduledDays.has(checkDate.getDay())) { 
            db.streak = 0; 
            save(); 
            showToast("Streak Terputus!", "üî•");
            return; 
        }
        checkDate.setDate(checkDate.getDate() + 1);
    }
}

/* --- INITIALIZATION --- */
window.addEventListener("scroll", reveal);
validateStreak();
if(db.theme === 'light') document.body.classList.add('light-mode');
render();

// Fitur tambahan: Close modal dengan klik di luar area content
window.onclick = function(event) {
    if (event.target.classList.contains('modal')) {
        closeModal(event.target.id);
    }
}
document.getElementById('zenith-contact-form').addEventListener('submit', function(e) {
    e.preventDefault(); // Mencegah halaman reload
    document.getElementById('contact-success').style.display = 'block';
    setTimeout(() => {
        document.getElementById('contact-success').style.display = 'none';
    }, 3000);
    this.reset(); // Mengosongkan form
});

</script>
</body>
</html>
