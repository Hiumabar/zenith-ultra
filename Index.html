<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zenith Ultra</title>
    <meta name="google-site-verification" content="HuH731if_mx1v-_UBpD2SQ61c2JBhEEctxXELLG40sc" />
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#10b981">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="icon" type="image/png" href="https://i.ibb.co.com/PLCqHHz/app-icon.png">
    <link rel="apple-touch-icon" href="https://i.ibb.co.com/PLCqHHz/app-icon.png">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

    <style>
        :root { --bg: #030712; --card: #111827; --text: #f9fafb; --prim: #10b981; --border: #1f2937; --sec: #374151; --accent: #f59e0b; --danger: #ef4444; --shadow: rgba(0,0,0,0.4); }
        .light-mode { --bg: #f3f4f6; --card: #ffffff; --text: #111827; --border: #e5e7eb; --prim: #059669; --sec: #d1d5db; --accent: #d97706; --shadow: rgba(0,0,0,0.1); }
        
        * { box-sizing: border-box; font-family: 'Inter', -apple-system, sans-serif; transition: 0.25s cubic-bezier(0.4, 0, 0.2, 1); -webkit-user-select: none; user-select: none; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); margin: 0; padding: 16px; padding-bottom: 200px; overflow-x: hidden; scroll-behavior: smooth; }
        .reveal { opacity: 0; transform: translateY(30px); transition: all 0.6s ease-out; }
        .reveal.active { opacity: 1; transform: translateY(0); }
        .card { background: var(--card); border-radius: 24px; padding: 24px; margin-bottom: 16px; border: 1px solid var(--border); box-shadow: 0 10px 15px -3px var(--shadow); position: relative; }
        .flex { display: flex; justify-content: space-between; align-items: center; }
        .badge { font-size: 10px; padding: 4px 10px; border-radius: 50px; font-weight: bold; background: var(--prim); color: #000; }
        .streak-badge { background: rgba(245, 158, 11, 0.1); color: var(--accent); border: 1px solid var(--accent); }
        .heat-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; margin-top: 10px; }
        .cell { aspect-ratio: 1; background: var(--sec); border-radius: 5px; }
        .cell.active { background: var(--prim); box-shadow: 0 0 12px var(--prim); }
        .p-bg { background: var(--sec); height: 10px; border-radius: 10px; margin: 12px 0; overflow: hidden; }
        .p-fill { background: linear-gradient(90deg, var(--prim), #34d399); height: 100%; transition: 1.5s cubic-bezier(0.17, 0.67, 0.83, 0.67); }
        .btn { border: none; padding: 14px; border-radius: 18px; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 14px; position: relative; }
        .btn:active { transform: scale(0.92); }
        .btn-prim { background: var(--prim); color: #000; box-shadow: 0 8px 20px -6px var(--prim); }
        .btn-sec { background: var(--card); color: var(--text); border: 1px solid var(--border); }
        .btn-del { background: transparent; color: var(--danger); border: none; padding: 5px; cursor: pointer; font-size: 18px; }
        .fab-container { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); width: 92%; max-width: 420px; background: rgba(17, 24, 39, 0.7); backdrop-filter: blur(25px); padding: 10px; border-radius: 100px; display: flex; gap: 10px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); border: 1px solid rgba(255,255,255,0.08); z-index: 1000; }
        .fab-btn { border-radius: 100px !important; flex: 1; height: 54px; }
        .fab-main { flex: 2.2; background: var(--prim); color: #000; }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(15px); display: none; align-items: center; justify-content: center; z-index: 2000; padding: 20px; opacity: 0; }
        .modal.active { display: flex; opacity: 1; }
        .modal-content { background: var(--card); width: 100%; max-width: 500px; border-radius: 32px; padding: 28px; max-height: 90vh; overflow-y: auto; border: 1px solid var(--border); }
        input, select { width: 100%; padding: 16px; border-radius: 16px; background: var(--bg); color: var(--text); border: 1px solid var(--border); margin-bottom: 16px; outline: none; font-size: 16px; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 20px 0; }
        .stat-item { background: var(--bg); padding: 16px; border-radius: 20px; border: 1px solid var(--border); }
        .stat-label { font-size: 10px; opacity: 0.5; text-transform: uppercase; letter-spacing: 1px; }
        .stat-val { font-size: 16px; font-weight: 800; color: var(--prim); margin-top: 4px; }
        .history-table { width: 100%; border-collapse: separate; border-spacing: 0 8px; font-size: 12px; }
        .history-table tr { background: var(--bg); }
        .history-table td { padding: 12px; border-top: 1px solid var(--border); border-bottom: 1px solid var(--border); }
        .history-table td:first-child { border-left: 1px solid var(--border); border-radius: 12px 0 0 12px; }
        .history-table td:last-child { border-right: 1px solid var(--border); border-radius: 0 12px 12px 0; }
        #wizard { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 30px; }
    </style>
</head>
<body oncontextmenu="return false">

    <div id="wizard">
        <div class="wiz-step active" id="step1">
            <h1 style="color:var(--prim); font-size: 48px; margin-bottom:10px; letter-spacing: -2px;">Zenith.</h1>
            <p style="opacity:0.7; font-size: 18px;">Arsitektur finansial masa depan Anda.</p>
            <button class="btn btn-prim" onclick="nextStep(2)" style="margin: 30px auto; width: 220px; border-radius: 100px;">Mulai Eksplorasi</button>
        </div>
        <div class="wiz-step" id="step2" style="display:none">
            <h2>üéØ Target Utama?</h2>
            <input type="text" id="oName" placeholder="Nama Impian">
            <input type="number" id="oGoal" placeholder="Target Nominal (Rp)">
            <button class="btn btn-prim" onclick="nextStep(3)" style="margin: 0 auto; width: 220px; border-radius: 100px;">Lanjut</button>
        </div>
        <div class="wiz-step" id="step3" style="display:none">
            <h2>‚ú® Sistem Siap</h2>
            <button class="btn btn-prim" onclick="initApp()" style="margin: 0 auto; width: 220px; border-radius: 100px;">Aktifkan Zenith</button>
        </div>
    </div>

    <div class="flex reveal" style="margin-bottom:20px; padding-top: 10px;">
        <h2 style="margin:0; letter-spacing:-1.5px; font-weight: 900; font-size: 24px;">ZENITH ULTRA<span style="color:var(--prim)">.</span></h2>
        <div class="flex" style="gap:10px;">
            <div class="badge streak-badge">üî• <span id="stkVal">0</span> DAYS</div>
            <button onclick="toggleTheme()" class="btn btn-sec" style="padding:0; border-radius:50%; width:44px; height:44px; border: none; background: var(--card);">üåì</button>
        </div>
    </div>

    <div class="card reveal" onclick="openStats()" style="cursor: pointer;">
        <div class="flex">
            <span style="font-size:10px; font-weight:800; opacity:0.6; letter-spacing: 1.5px;">MARKET ANALYTICS</span>
            <span id="levelBadge" class="badge">Bronze Tier</span>
        </div>
        <div class="heat-grid" id="heatGrid"></div>
        <canvas id="mainChart" height="140" style="margin-top:20px;"></canvas>
    </div>

    <div id="targetList"></div>

    <div class="fab-container">
        <button class="btn btn-sec fab-btn" onclick="openModal('exportModal')">üíæ</button>
        <button class="btn fab-btn fab-main" onclick="openModal('saveModal')">
            <b>üí∞ TRANSAKSI</b>
        </button>
        <button class="btn btn-sec fab-btn" onclick="openModal('targetModal')">üéØ</button>
    </div>

    <div id="exportModal" class="modal">
        <div class="modal-content">
            <h3 style="margin-top:0">Data Portofolio</h3>
            <button class="btn btn-prim" onclick="handleExport('pdf')" style="margin-bottom:12px; background:#ef4444; color:white; width: 100%;">üìï Ekspor PDF Premium</button>
            <button class="btn btn-prim" onclick="handleExport('excel')" style="background:#10b981; color:black; width: 100%;">üìó Ekspor Excel</button>
            <button class="btn btn-sec" onclick="closeModal('exportModal')" style="width:100%; margin-top:20px; border-radius: 100px;">Tutup</button>
        </div>
    </div>

    <div id="saveModal" class="modal">
        <div class="modal-content">
            <h3 style="margin-top:0">Input Transaksi</h3>
            <select id="saveType">
                <option value="in">üí∞ Masuk (Nabung)</option>
                <option value="out">üí∏ Keluar (Tarik)</option>
            </select>
            <select id="saveTo"></select>
            <input type="number" id="saveAmt" placeholder="Jumlah Rp" inputmode="numeric">
            <button class="btn btn-prim" onclick="handleSaveAction()" style="width: 100%;">Proses Transaksi</button>
            <button class="btn btn-sec" onclick="closeModal('saveModal')" style="width:100%; margin-top:12px; border-radius: 100px;">Batal</button>
        </div>
    </div>

    <div id="targetModal" class="modal">
        <div class="modal-content">
            <h3 style="margin-top:0">üéØ Target Baru</h3>
            <input type="text" id="ntName" placeholder="Nama Barang">
            <input type="number" id="ntGoal" placeholder="Target Dana">
            <button class="btn btn-prim" onclick="doAddTarget()" style="width: 100%;">Simpan Target</button>
            <button class="btn btn-sec" onclick="closeModal('targetModal')" style="width:100%; margin-top:12px; border-radius: 100px;">Batal</button>
        </div>
    </div>

    <div id="statsModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="flex">
                <h3 style="color:var(--prim); margin:0">Zenith Insights</h3>
                <button class="btn-del" onclick="closeModal('statsModal')" style="font-size: 24px;">√ó</button>
            </div>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-label">Total Assets</div>
                    <div class="stat-val" id="statTotal">Rp 0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Saving Streak</div>
                    <div class="stat-val" id="statStreak">0 Days</div>
                </div>
            </div>
            <canvas id="barChart" height="200"></canvas>
            <h4 style="margin: 25px 0 15px 0; font-size: 14px; opacity: 0.7;">ACTIVITY LOG</h4>
            <div style="overflow-x: auto;">
                <table class="history-table">
                    <tbody id="historyBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // PWA Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').catch(err => console.log('SW error:', err));
            });
        }

        let db = JSON.parse(localStorage.getItem('ss_ultra_db')) || { targets: [], logs: [], streak: 0, lastDate: null, theme: 'dark' };
        let lineChart, barChart;

        function reveal() {
            document.querySelectorAll(".reveal").forEach(el => {
                if (el.getBoundingClientRect().top < window.innerHeight - 50) el.classList.add("active");
            });
        }
        window.addEventListener("scroll", reveal);

        function getEstimation(target) {
            const remaining = target.goal - target.saved;
            if (remaining <= 0) return "Goal Achieved! üèÜ";
            const logs = db.logs.filter(l => l.t === target.name && l.v > 0);
            if (logs.length < 2) return "Collecting more data...";
            const start = new Date(logs[0].d);
            const end = new Date(logs[logs.length-1].d);
            const days = Math.max(1, Math.round((end - start) / 86400000));
            const total = logs.reduce((s, l) => s + l.v, 0);
            const avg = total / days;
            if (avg <= 0) return "Waiting for activity...";
            const daysLeft = Math.ceil(remaining / avg);
            return daysLeft > 30 ? `${(daysLeft/30).toFixed(1)} Months left` : `${daysLeft} Days left`;
        }

        function openModal(id) {
            const m = document.getElementById(id);
            if(id === 'saveModal' && db.targets.length === 0) { showToast("Buat target dulu!"); return; }
            m.style.display = 'flex';
            setTimeout(() => m.classList.add('active'), 10);
            if(id === 'saveModal') {
                document.getElementById('saveTo').innerHTML = db.targets.map((t,i) => `<option value="${i}">${t.name}</option>`).join('');
            }
        }

        function closeModal(id) {
            const m = document.getElementById(id);
            m.classList.remove('active');
            setTimeout(() => m.style.display = 'none', 300);
        }

        function handleSaveAction() {
            const idx = document.getElementById('saveTo').value;
            let amt = parseInt(document.getElementById('saveAmt').value);
            if(!amt || amt <= 0) return;
            if(document.getElementById('saveType').value === 'out') {
                if(db.targets[idx].saved < amt) { showToast("Saldo Tidak Cukup"); return; }
                amt = -amt;
            }
            db.targets[idx].saved += amt;
            const today = new Date().toDateString();
            if(amt > 0 && db.lastDate !== today) { db.streak++; db.lastDate = today; }
            db.logs.push({ d: new Date().toISOString(), v: amt, t: db.targets[idx].name });
            showToast("Transaksi Berhasil");
            closeModal('saveModal');
            document.getElementById('saveAmt').value = '';
            save();
        }

        function doAddTarget() {
            const n = document.getElementById('ntName').value, g = document.getElementById('ntGoal').value;
            if(n && g) {
                db.targets.push({name:n, goal:parseInt(g), saved:0});
                document.getElementById('ntName').value = '';
                document.getElementById('ntGoal').value = '';
                closeModal('targetModal');
                save();
                showToast("Target Disimpan");
            }
        }

        function handleExport(type) {
            if (db.logs.length === 0) { showToast("Belum ada data!"); return; }

            if (type === 'pdf') {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const totalAssets = db.targets.reduce((a, b) => a + b.saved, 0);
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();

                // Cover Page
                doc.setFillColor(3, 7, 18); 
                doc.rect(0, 0, pageWidth, pageHeight, 'F');
                doc.setDrawColor(16, 185, 129);
                doc.setLineWidth(2);
                doc.line(20, 40, 60, 40);
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(40);
                doc.text("ZENITH", 20, 80);
                doc.setTextColor(16, 185, 129);
                doc.text("ULTRA.", 20, 95);
                doc.setFontSize(14);
                doc.setTextColor(150, 150, 150);
                doc.text("Personal Financial Architecture Report", 20, 110);
                doc.setFontSize(10);
                doc.text(`Generated: ${new Date().toLocaleString()}`, 20, 260);

                // Data Page
                doc.addPage();
                doc.setTextColor(3, 7, 18);
                doc.setFontSize(18);
                doc.text("DASHBOARD SUMMARY", 14, 20);
                doc.setDrawColor(230, 230, 230);
                doc.setFillColor(245, 250, 248);
                doc.roundedRect(14, 30, 182, 30, 3, 3, 'FD');
                doc.setFontSize(10);
                doc.setTextColor(100);
                doc.text("TOTAL ASSETS", 20, 40);
                doc.setFontSize(16);
                doc.setTextColor(16, 185, 129);
                doc.text(`Rp ${totalAssets.toLocaleString('id-ID')}`, 20, 52);
                doc.setFontSize(10);
                doc.setTextColor(100);
                doc.text("SAVING STREAK", 140, 40);
                doc.setTextColor(245, 158, 11);
                doc.text(`${db.streak} DAYS`, 140, 52);

                const rows = db.logs.slice().reverse().map(l => [
                    new Date(l.d).toLocaleDateString('id-ID'),
                    l.t,
                    l.v > 0 ? 'IN' : 'OUT',
                    `Rp ${Math.abs(l.v).toLocaleString('id-ID')}`
                ]);

                doc.autoTable({
                    head: [['Date', 'Target', 'Type', 'Amount']],
                    body: rows,
                    startY: 70,
                    theme: 'striped',
                    headStyles: { fillColor: [16, 185, 129] }
                });

                doc.save(`Zenith_Report_${Date.now()}.pdf`);
            } else {
                exportExcel();
            }
            closeModal('exportModal');
        }

        function exportExcel() {
            let csv = "\uFEFFDate,Target,Type,Amount\n";
            db.logs.slice().reverse().forEach(l => {
                csv += `${new Date(l.d).toLocaleDateString()},${l.t},${l.v > 0 ? 'IN' : 'OUT'},${Math.abs(l.v)}\n`;
            });
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Zenith_Data_${Date.now()}.csv`;
            a.click();
        }

        function openStats() {
            const total = db.targets.reduce((a,b)=>a+b.saved, 0);
            document.getElementById('statTotal').innerText = `Rp ${total.toLocaleString()}`;
            document.getElementById('statStreak').innerText = `${db.streak} Days`;
            const hBody = document.getElementById('historyBody');
            hBody.innerHTML = db.logs.slice().reverse().slice(0, 15).map(l => `
                <tr>
                    <td style="opacity:0.5">${new Date(l.d).toLocaleDateString('id-ID',{day:'2-digit', month:'short'})}</td>
                    <td><b>${l.t}</b></td>
                    <td style="text-align:right; color:${l.v > 0 ? 'var(--prim)' : 'var(--danger)'}">
                        ${l.v > 0 ? '+' : ''}${l.v.toLocaleString()}
                    </td>
                </tr>
            `).join('');
            openModal('statsModal');
            setTimeout(renderBarChart, 400);
        }

        function renderBarChart() {
            const ctx = document.getElementById('barChart').getContext('2d');
            const dataMap = {};
            db.logs.slice(-10).forEach(l => {
                const d = new Date(l.d).toLocaleDateString('id-ID', {day:'2-digit'});
                dataMap[d] = (dataMap[d] || 0) + Math.abs(l.v);
            });
            if(barChart) barChart.destroy();
            barChart = new Chart(ctx, {
                type: 'bar',
                data: { labels: Object.keys(dataMap), datasets: [{ data: Object.values(dataMap), backgroundColor: '#10b981', borderRadius: 8 }] },
                options: { plugins: { legend: { display: false } }, scales: { y: { display: false }, x: { grid: { display: false } } } }
            });
        }

        function render() {
            document.getElementById('wizard').style.display = db.targets.length === 0 ? 'flex' : 'none';
            document.getElementById('stkVal').innerText = db.streak;
            const list = document.getElementById('targetList');
            list.innerHTML = db.targets.map((t, i) => {
                const p = Math.min((t.saved/t.goal)*100, 100).toFixed(1);
                return `
                <div class="card reveal active">
                    <div class="flex">
                        <b style="font-size:18px">${t.name}</b> 
                        <div class="flex" style="gap:12px;">
                            <span class="badge">${p}%</span>
                            <button class="btn-del" onclick="deleteTarget(${i})">üóëÔ∏è</button>
                        </div>
                    </div>
                    <div class="p-bg"><div class="p-fill" style="width:${p}%"></div></div>
                    <div class="flex" style="font-size:12px; font-weight:700">
                        <span>Rp ${t.saved.toLocaleString()}</span>
                        <span style="opacity:0.5">Target Rp ${t.goal.toLocaleString()}</span>
                    </div>
                    <div style="font-size:10px; color:var(--accent); margin-top:12px; font-weight:800;">‚ö° ${getEstimation(t)}</div>
                </div>`;
            }).join('');
            renderHeatmap(); renderLineChart();
            setTimeout(reveal, 100);
        }

        function renderLineChart() {
            const ctx = document.getElementById('mainChart').getContext('2d');
            const lastData = db.logs.slice(-10).map(l => l.v);
            if(lineChart) lineChart.destroy();
            lineChart = new Chart(ctx, {
                type: 'line',
                data: { labels: lastData.map(()=>""), datasets: [{ data: lastData, borderColor: '#10b981', tension: 0.4, fill: true, backgroundColor: 'rgba(16,185,129,0.1)', pointRadius: 0 }] },
                options: { plugins: { legend: { display: false } }, scales: { y: { display: false }, x: { display: false } } }
            });
        }

        function renderHeatmap() {
            const h = document.getElementById('heatGrid'); h.innerHTML = '';
            const dates = db.logs.map(l => new Date(l.d).toDateString());
            for(let i=0; i<21; i++) {
                const d = new Date(); d.setDate(d.getDate() - (20-i));
                const c = document.createElement('div');
                c.className = 'cell' + (dates.includes(d.toDateString()) ? ' active' : '');
                h.appendChild(c);
            }
        }

        function save() { localStorage.setItem('ss_ultra_db', JSON.stringify(db)); render(); }
        function nextStep(s) { 
            document.querySelectorAll('.wiz-step').forEach(el => el.style.display = 'none');
            document.getElementById('step'+s).style.display = 'block';
        }
        function initApp() { 
            const n = document.getElementById('oName').value, g = document.getElementById('oGoal').value;
            if(n && g) { db.targets.push({name:n, goal:parseInt(g), saved:0}); save(); }
        }
        function toggleTheme() { document.body.classList.toggle('light-mode'); db.theme = document.body.classList.contains('light-mode') ? 'light' : 'dark'; save(); }
        function deleteTarget(i) { if(confirm("Hapus target?")) { db.targets.splice(i,1); save(); } }
        function showToast(m) { alert(m); }

        render();
    </script>
</body>
</html>
